{
  "schema_version": "3.0",
  "project": "spawnie",
  "description": "Workflow orchestrator for CLI agents. First system fully embracing seed philosophy.",
  "updated_at": "2026-02-01T04:45:00Z",
  "source_root": "..",

  "meta": {
    "layers": {
      "description": "Layers are contextual lenses for interpreting nodes, not categories",
      "aspiration": "The 'why' - goals, intent, human-controlled",
      "design": "The 'what' - structure, workflows, config, definitions",
      "execution": "The 'now' - active state, running processes, inputs/outputs",
      "reality": "The 'is' - verified artifacts, hashes, ground truth"
    },
    "hierarchy": {
      "description": "Nodes can contain sub-BAMs. Zoom in for detail, zoom out for overview.",
      "current_level": "system",
      "levels": ["meta", "reality", "system", "module", "component", "leaf"]
    }
  },

  "node_types": {
    "Subsystem": {
      "description": "A major component of the system containing its own sub-BAM",
      "properties": ["description"],
      "can_contain_model": true
    },
    "Module": {
      "description": "Python module (file)",
      "properties": ["path", "description"]
    },
    "Class": {
      "description": "Python class",
      "properties": ["description", "line"]
    },
    "Function": {
      "description": "Standalone function",
      "properties": ["description", "line"]
    },
    "Dataclass": {
      "description": "Data structure",
      "properties": ["description", "line"]
    },
    "CLICommand": {
      "description": "CLI command exposed by spawnie",
      "properties": ["description", "line"]
    },
    "Concept": {
      "description": "Architectural concept or pattern",
      "properties": ["description"]
    },
    "Workflow": {
      "description": "Executable workflow definition",
      "properties": ["name", "description", "steps", "timeout"],
      "can_contain_model": true
    },
    "Config": {
      "description": "Configuration definition",
      "properties": ["providers", "models", "preferences"]
    },
    "Aspiration": {
      "description": "A goal or intent - human controlled",
      "properties": ["description", "status"]
    }
  },

  "edge_types": {
    "CONTAINS": {
      "description": "Parent contains child in hierarchy",
      "from_types": ["Subsystem"],
      "to_types": ["Module", "Subsystem"]
    },
    "IMPORTS": {
      "description": "Module imports another module",
      "from_types": ["Module"],
      "to_types": ["Module"]
    },
    "DEFINES": {
      "description": "Module defines a class/function",
      "from_types": ["Module"],
      "to_types": ["Class", "Function", "Dataclass"]
    },
    "EMBODIES": {
      "description": "Code embodies an architectural concept",
      "from_types": ["Subsystem", "Module"],
      "to_types": ["Concept"]
    },
    "IMPLEMENTS": {
      "description": "Realizes an aspiration",
      "from_types": ["Subsystem", "Module", "Workflow"],
      "to_types": ["Aspiration"]
    }
  },

  "nodes": [
    {
      "id": "subsystem-core",
      "type": "Subsystem",
      "label": "Core",
      "description": "Core modules: API, workflow execution, tracking, registry",
      "model": {
        "nodes": [
          {
            "id": "mod-api",
            "type": "Module",
            "label": "api.py",
            "source": {"file": "src/spawnie/api.py", "hash": "c32e29155818e88c451303e5280e94efea730fcc05879028d110cda698cf6d13"},
            "model": {
              "nodes": [
                {"id": "fn-run", "type": "Function", "label": "run()", "line": 29},
                {"id": "fn-execute", "type": "Function", "label": "execute()", "line": 365},
                {"id": "fn-spawn", "type": "Function", "label": "spawn()", "line": 158},
                {"id": "fn-list-models", "type": "Function", "label": "list_models()", "line": 340}
              ],
              "edges": [
                {"type": "CALLS", "from": "fn-run", "to": "fn-execute"}
              ]
            }
          },
          {
            "id": "mod-workflow",
            "type": "Module",
            "label": "workflow.py",
            "source": {"file": "src/spawnie/workflow.py", "hash": "5d140e997b6a99686684d1126488d107e1d3cc656fa58d9271c9b9fb925986b7"},
            "model": {
              "nodes": [
                {"id": "cls-workflow-executor", "type": "Class", "label": "WorkflowExecutor", "line": 328},
                {"id": "cls-workflow-def", "type": "Class", "label": "WorkflowDefinition", "line": 137},
                {"id": "dc-step-definition", "type": "Dataclass", "label": "StepDefinition", "line": 109},
                {"id": "dc-workflow-result", "type": "Dataclass", "label": "WorkflowResult", "line": 302}
              ],
              "edges": []
            }
          },
          {
            "id": "mod-tracker",
            "type": "Module",
            "label": "tracker.py",
            "source": {"file": "src/spawnie/tracker.py", "hash": "c4561408b1272866a4f8423d66b811cb7cd5575e59e90397d8f42adef3f0f165"},
            "model": {
              "nodes": [
                {"id": "cls-tracker", "type": "Class", "label": "Tracker", "line": 215},
                {"id": "dc-task-state", "type": "Dataclass", "label": "TaskState", "line": 24},
                {"id": "dc-workflow-state", "type": "Dataclass", "label": "WorkflowState", "line": 124},
                {"id": "dc-step-state", "type": "Dataclass", "label": "StepState", "line": 89},
                {"id": "fn-get-tracker", "type": "Function", "label": "get_tracker()", "line": 1050}
              ],
              "edges": []
            }
          },
          {
            "id": "mod-registry",
            "type": "Module",
            "label": "registry.py",
            "source": {"file": "src/spawnie/registry.py", "hash": "pending-update"},
            "model": {
              "nodes": [
                {"id": "cls-registry", "type": "Class", "label": "ModelRegistry", "line": 136},
                {"id": "fn-get-registry", "type": "Function", "label": "get_registry()", "line": 400},
                {"id": "fn-get-config-from-model", "type": "Function", "label": "get_config_from_model()", "line": 24}
              ],
              "edges": []
            }
          },
          {
            "id": "mod-session",
            "type": "Module",
            "label": "session.py",
            "source": {"file": "src/spawnie/session.py", "hash": "59138744d65b484a9803a52ee83e9573ad7967ba65d7bfec2a55111574cf30bb"},
            "model": {
              "nodes": [
                {"id": "cls-shell-session", "type": "Class", "label": "ShellSession", "line": 143}
              ],
              "edges": []
            }
          },
          {
            "id": "mod-monitor",
            "type": "Module",
            "label": "monitor.py",
            "source": {"file": "src/spawnie/monitor.py", "hash": "519004d199f366e8f6103debc0c0d26f61da0825277c0231786df43ac127ddc4"},
            "model": {
              "nodes": [
                {"id": "cls-monitor-app", "type": "Class", "label": "SpawnieMonitor", "line": 184},
                {"id": "fn-run-monitor", "type": "Function", "label": "run_monitor()", "line": 354}
              ],
              "edges": []
            }
          },
          {
            "id": "mod-main",
            "type": "Module",
            "label": "__main__.py",
            "source": {"file": "src/spawnie/__main__.py", "hash": "pending-update"},
            "model": {
              "nodes": [
                {"id": "cli-run", "type": "CLICommand", "label": "spawnie run", "line": 80},
                {"id": "cli-workflow", "type": "CLICommand", "label": "spawnie workflow", "line": 122},
                {"id": "cli-workflows", "type": "CLICommand", "label": "spawnie workflows", "line": 926},
                {"id": "cli-monitor", "type": "CLICommand", "label": "spawnie monitor", "line": 380},
                {"id": "cli-status", "type": "CLICommand", "label": "spawnie status", "line": 183},
                {"id": "cli-shell", "type": "CLICommand", "label": "spawnie shell", "line": 450}
              ],
              "edges": []
            }
          },
          {
            "id": "mod-findings",
            "type": "Module",
            "label": "findings.py",
            "source": {"file": "src/spawnie/findings.py", "hash": "ed654307ea5f63bc0052e4f67a5c87533eef51578ad34e565a7cfef7ba5e4238"},
            "model": {
              "nodes": [
                {"id": "cls-finding", "type": "Class", "label": "Finding", "line": 104},
                {"id": "cls-findings-report", "type": "Class", "label": "FindingsReport", "line": 146}
              ],
              "edges": []
            }
          }
        ],
        "edges": [
          {"type": "IMPORTS", "from": "mod-api", "to": "mod-workflow"},
          {"type": "IMPORTS", "from": "mod-api", "to": "mod-tracker"},
          {"type": "IMPORTS", "from": "mod-api", "to": "mod-registry"},
          {"type": "IMPORTS", "from": "mod-workflow", "to": "mod-tracker"},
          {"type": "IMPORTS", "from": "mod-workflow", "to": "mod-registry"},
          {"type": "IMPORTS", "from": "mod-session", "to": "mod-tracker"},
          {"type": "IMPORTS", "from": "mod-monitor", "to": "mod-tracker"},
          {"type": "IMPORTS", "from": "mod-main", "to": "mod-api"}
        ]
      }
    },

    {
      "id": "subsystem-providers",
      "type": "Subsystem",
      "label": "Providers",
      "description": "LLM providers: CLI tools, APIs",
      "model": {
        "nodes": [
          {
            "id": "mod-providers-base",
            "type": "Module",
            "label": "providers/base.py",
            "source": {"file": "src/spawnie/providers/base.py", "hash": "1580f38cdcf80b33679c2825202190dbac37cd73091415d186c3318ebe9c1528"},
            "model": {
              "nodes": [
                {"id": "cls-cli-provider", "type": "Class", "label": "CLIProvider", "line": 14}
              ],
              "edges": []
            }
          },
          {
            "id": "mod-providers-claude",
            "type": "Module",
            "label": "providers/claude.py",
            "source": {"file": "src/spawnie/providers/claude.py", "hash": "a3a3a2c0ff7ae0b2968681ced4a9bc0f5414085a6640035fde766f99cdaa0541"},
            "model": {
              "nodes": [
                {"id": "cls-claude-provider", "type": "Class", "label": "ClaudeCLIProvider", "line": 9}
              ],
              "edges": []
            }
          }
        ],
        "edges": [
          {"type": "IMPORTS", "from": "mod-providers-claude", "to": "mod-providers-base"}
        ]
      }
    },

    {
      "id": "subsystem-workflows",
      "type": "Subsystem",
      "label": "Workflows",
      "description": "Workflow definitions - model is source of truth",
      "model": {
        "nodes": [
          {
            "id": "workflow-code-quality",
            "type": "Workflow",
            "label": "Code Quality Check",
            "name": "code-quality-check",
            "description": "Comprehensive code quality analysis",
            "timeout": 2700,
            "model": {
              "nodes": [
                {"id": "step-analyze-structure", "type": "Function", "label": "analyze_structure"},
                {"id": "step-check-consistency", "type": "Function", "label": "check_consistency"},
                {"id": "step-find-improvements", "type": "Function", "label": "find_improvements"},
                {"id": "step-run-tests", "type": "Function", "label": "run_tests"},
                {"id": "step-verify-docs", "type": "Function", "label": "verify_documentation"},
                {"id": "step-agent-feedback", "type": "Function", "label": "agent_usage_feedback"},
                {"id": "step-verify-findings", "type": "Function", "label": "verify_findings"},
                {"id": "step-synthesize", "type": "Function", "label": "synthesize_report"}
              ],
              "edges": [
                {"type": "DEPENDS", "from": "step-verify-findings", "to": "step-analyze-structure"},
                {"type": "DEPENDS", "from": "step-verify-findings", "to": "step-check-consistency"},
                {"type": "DEPENDS", "from": "step-synthesize", "to": "step-verify-findings"}
              ]
            }
          },
          {
            "id": "workflow-reality-check",
            "type": "Workflow",
            "label": "Reality Check",
            "name": "reality-check",
            "description": "Validates artifacts match model",
            "timeout": 1200,
            "model": {
              "nodes": [
                {"id": "step-load-context", "type": "Function", "label": "load_context"},
                {"id": "step-verify-reality", "type": "Function", "label": "verify_reality_nodes"},
                {"id": "step-verify-aspiration", "type": "Function", "label": "verify_aspiration_nodes"},
                {"id": "step-check-health", "type": "Function", "label": "check_system_health"},
                {"id": "step-check-integrity", "type": "Function", "label": "check_model_integrity"},
                {"id": "step-synthesize-report", "type": "Function", "label": "synthesize_reality_report"}
              ],
              "edges": []
            }
          },
          {
            "id": "workflow-complete-model",
            "type": "Workflow",
            "label": "Complete Model",
            "name": "complete-model",
            "description": "Complete BAM model coverage",
            "timeout": 7200,
            "model": {
              "nodes": [
                {"id": "step-scan", "type": "Function", "label": "scan_codebase"},
                {"id": "step-analyze-missing", "type": "Function", "label": "analyze_missing_modules"},
                {"id": "step-analyze-incomplete", "type": "Function", "label": "analyze_incomplete_modules"},
                {"id": "step-generate", "type": "Function", "label": "generate_model_updates"},
                {"id": "step-apply", "type": "Function", "label": "apply_updates"},
                {"id": "step-verify", "type": "Function", "label": "verify_model"}
              ],
              "edges": []
            }
          }
        ],
        "edges": []
      }
    },

    {
      "id": "config-spawnie",
      "type": "Config",
      "label": "Configuration",
      "description": "Model-first configuration",
      "providers": {
        "claude-cli": {"type": "cli", "command": "claude"},
        "copilot-cli": {"type": "cli", "command": "gh copilot"},
        "anthropic-api": {"type": "api", "api_key_env": "ANTHROPIC_API_KEY"},
        "mock": {"type": "mock"}
      },
      "models": {
        "claude-sonnet": {
          "routes": [
            {"provider": "claude-cli", "priority": 1, "model_id": "sonnet"},
            {"provider": "anthropic-api", "priority": 2, "model_id": "claude-sonnet-4-20250514"}
          ]
        },
        "claude-opus": {
          "routes": [
            {"provider": "claude-cli", "priority": 1, "model_id": "opus"},
            {"provider": "anthropic-api", "priority": 2, "model_id": "claude-opus-4-20250514"}
          ]
        },
        "claude-haiku": {
          "routes": [
            {"provider": "claude-cli", "priority": 1, "model_id": "haiku"},
            {"provider": "anthropic-api", "priority": 2, "model_id": "claude-haiku-3-20250414"}
          ]
        }
      },
      "preferences": {"prefer_cli": true}
    },

    {
      "id": "concept-model-first",
      "type": "Concept",
      "label": "Model-First Architecture",
      "description": "The model is the working vehicle. Workflows, configs, definitions are nodes. Physical files are projections."
    },
    {
      "id": "concept-hierarchical-bam",
      "type": "Concept",
      "label": "Hierarchical BAMs",
      "description": "Nodes contain sub-BAMs. Zoom in for detail, zoom out for overview."
    },
    {
      "id": "concept-layers-as-lenses",
      "type": "Concept",
      "label": "Layers as Lenses",
      "description": "Aspiration (why), Design (what), Execution (now), Reality (is) - perspectives, not categories."
    },

    {
      "id": "aspiration-seed-first",
      "type": "Aspiration",
      "label": "First Seed-Native System",
      "description": "Spawnie should be the first system fully embracing seed philosophy: model-first, hierarchical BAMs, layers as lenses.",
      "status": "in-progress"
    },
    {
      "id": "aspiration-self-describing",
      "type": "Aspiration",
      "label": "Self-Describing Model",
      "description": "The model should fully describe spawnie. Given the model, spawnie could be regenerated.",
      "status": "future"
    }
  ],

  "edges": [
    {"type": "EMBODIES", "from": "subsystem-core", "to": "concept-model-first"},
    {"type": "EMBODIES", "from": "subsystem-workflows", "to": "concept-model-first"},
    {"type": "EMBODIES", "from": "subsystem-core", "to": "concept-hierarchical-bam"},
    {"type": "IMPLEMENTS", "from": "subsystem-workflows", "to": "aspiration-seed-first"},
    {"type": "IMPLEMENTS", "from": "config-spawnie", "to": "aspiration-seed-first"}
  ]
}
